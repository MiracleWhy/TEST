<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.uton.carsokApi.dao.DailycheckResultMapper">
  <resultMap id="BaseResultMap" type="com.uton.carsokApi.model.DailycheckResult">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="result" jdbcType="VARCHAR" property="result" />
    <result column="checker" jdbcType="VARCHAR" property="checker" />
    <result column="is_check" jdbcType="INTEGER" property="isCheck" />
    <result column="product_id" jdbcType="INTEGER" property="productId" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
    <result column="enable" jdbcType="INTEGER" property="enable" />
    <result column="check_date" jdbcType="VARCHAR" property="checkDate" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, result, checker, is_check, product_id, create_time, update_time, enable,check_date
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from carsok_dailycheck_result
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from carsok_dailycheck_result
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.uton.carsokApi.model.DailycheckResult">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into carsok_dailycheck_result (id, result, checker, 
      is_check, product_id, create_time, 
      update_time, enable,check_date)
    values (#{id,jdbcType=INTEGER}, #{result,jdbcType=VARCHAR}, #{checker,jdbcType=VARCHAR}, 
      #{isCheck,jdbcType=INTEGER}, #{productId,jdbcType=INTEGER}, now(),
      now(), #{enable,jdbcType=INTEGER}, #{checkDate,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.uton.carsokApi.model.DailycheckResult">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into carsok_dailycheck_result
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="result != null">
        result,
      </if>
      <if test="checker != null">
        checker,
      </if>
      <if test="isCheck != null">
        is_check,
      </if>
      <if test="productId != null">
        product_id,
      </if>
      <if test="createTime != null">
        create_time,
      </if>
      <if test="updateTime != null">
        update_time,
      </if>
      <if test="enable != null">
        enable,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=INTEGER},
      </if>
      <if test="result != null">
        #{result,jdbcType=VARCHAR},
      </if>
      <if test="checker != null">
        #{checker,jdbcType=VARCHAR},
      </if>
      <if test="isCheck != null">
        #{isCheck,jdbcType=INTEGER},
      </if>
      <if test="productId != null">
        #{productId,jdbcType=INTEGER},
      </if>
      <if test="createTime != null">
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateTime != null">
        #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="enable != null">
        #{enable,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.uton.carsokApi.model.DailycheckResult">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update carsok_dailycheck_result
    <set>
      <if test="result != null">
        result = #{result,jdbcType=VARCHAR},
      </if>
      <if test="checker != null">
        checker = #{checker,jdbcType=VARCHAR},
      </if>
      <if test="isCheck != null">
        is_check = #{isCheck,jdbcType=INTEGER},
      </if>
      <if test="productId != null">
        product_id = #{productId,jdbcType=INTEGER},
      </if>
      <if test="createTime != null">
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateTime != null">
        update_time = #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="enable != null">
        enable = #{enable,jdbcType=INTEGER},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.uton.carsokApi.model.DailycheckResult">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update carsok_dailycheck_result
    set result = #{result,jdbcType=VARCHAR},
      checker = #{checker,jdbcType=VARCHAR},
      is_check = #{isCheck,jdbcType=INTEGER},
      product_id = #{productId,jdbcType=INTEGER},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      update_time = now(),
      enable = #{enable,jdbcType=INTEGER},
      check_date=#{checkDate,jdbcType=VARCHAR}
    where id = #{id,jdbcType=INTEGER}
  </update>
  <select id="getCheckResultByProductId" resultMap="BaseResultMap">
    SELECT * FROM carsok_dailycheck_result WHERE product_id= #{productId}
     <if test="checkDate!='' and checkDate!=null">
    AND DATE_FORMAT(create_time,'%Y-%m-%d')=#{checkDate}
     </if>
  </select>
  <select id="getHistoryResult" resultMap="BaseResultMap">
    SELECT * FROM carsok_dailycheck_result WHERE product_id= #{productId}
  </select>
  <select id="getProductInfoByProductId" resultType="com.uton.carsokApi.model.DailyCheckProductInfo">
    select a.id as productId,a.account_id as accountId,
    a.product_name as productName,
    b.first_up_time as firstUpTime,b.miles, a.*
    from carsok_product a
    left join carsok_pruduct_oldcar b on a.id=b.pruduct_id
    where a.id=#{productId}
  </select>
  <select id="getCheckerResult" resultType="com.uton.carsokApi.controller.response.DailyCheckCheckerResult">
      select b.*,IFNULL(c.child_account_name,'主账号') as checkerName,d.pic_path as picPath,e.first_up_time as firstUpTime,e.miles,a.checker,b.product_name as productName
      from carsok_dailycheck_result a
      left join carsok_product b on a.product_id=b.id
      left join carsok_child_account c on a.checker=c.child_account_mobile
      left join (select * from carsok_picture where type=1) d on a.product_id=d.product_id
      left join carsok_pruduct_oldcar e on a.product_id=e.pruduct_id
      where b.account_id=#{accountId}
      <if test="hasChecker">
      and a.checker=#{checker}
      </if>
      and DATE_FORMAT(a.create_time,'%Y-%m-%d')=#{checkDate}
  </select>
  <select id="getResultList" resultType="com.uton.carsokApi.controller.response.DailyCheckCheckerResult">
    select a.*,d.pic_path as picPath,e.first_up_time as firstUpTime,e.miles,a.product_name as productName
    from (select * from carsok_product where is_del=0 and on_shelf_status=1 and (sale_status=0 or (sale_status=1 and DATE_FORMAT(update_time,'%Y-%m-%d')>=#{checkDate})) and #{checkDate}>=DATE_FORMAT(create_time,'%Y-%m-%d')) a
    left join (select * from carsok_dailycheck_result where DATE_FORMAT(check_date,'%Y-%m-%d')=#{checkDate}) b on a.id=b.product_id
    left join (select * from carsok_picture where type=1) d on a.id=d.product_id
    left join carsok_pruduct_oldcar e on a.id=e.pruduct_id
    where a.account_id=#{accountId}
    <if test="isNotAll">
    and b.id is null;
    </if>
  </select>
</mapper>