<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.uton.carsokApi.dao.ShareRecordMapper" >
  <resultMap id="BaseResultMap" type="com.uton.carsokApi.model.ShareRecord" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" property="id" jdbcType="INTEGER"/>
    <result column="share_account_code" property="shareAccountCode" jdbcType="VARCHAR"/>
    <result column="share_date" property="shareDate" jdbcType="TIMESTAMP"/>
  </resultMap>

  <resultMap id="shareRankList" type="com.uton.carsokApi.controller.response.ShareRankResponse">
    <result column="count" property="count" jdbcType="VARCHAR"/>
    <result column="account_code" property="accountCode" jdbcType="VARCHAR"/>
    <result column="account" property="account" jdbcType="VARCHAR"/>
  </resultMap>

  <resultMap id="shareRankListByCondition" type="com.uton.carsokApi.controller.response.ShareRankResponse">
    <result column="real_name" property="realName" jdbcType="VARCHAR"/>
    <result column="count" property="count" jdbcType="VARCHAR"/>
    <result column="share_account_code" property="shareAccountCode" jdbcType="VARCHAR"/>
    <result column="account_code" property="accountCode" jdbcType="VARCHAR"/>
  </resultMap>

  <resultMap id="shareRankListCount" type="com.uton.carsokApi.controller.response.ShareRankList">
    <result column="shareCount" property="shareCount" jdbcType="VARCHAR"/>
    <result column="name" property="name" jdbcType="VARCHAR"/>
    <result column="shareDate" property="shareDate" jdbcType="TIMESTAMP"/>
    <result column="startDay" property="startDay" jdbcType="TIMESTAMP"/>
    <result column="endDay" property="endDay" jdbcType="TIMESTAMP"/>
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, share_account_code, share_date
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from share_record
    where id = #{id}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from share_record
    where id = #{id}
  </delete>
  <insert id="insert" parameterType="com.uton.carsokApi.model.ShareRecord">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into share_record (share_account_code, share_date)
    values (#{shareAccountCode}, #{shareDate})
  </insert>
  <insert id="insertSelective" parameterType="com.uton.carsokApi.model.ShareRecord" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into share_record
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="shareAccountCode != null" >
        share_account_code,
      </if>
      <if test="shareDate != null" >
        share_date,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=INTEGER},
      </if>
      <if test="shareAccountCode != null" >
        #{shareAccountCode},
      </if>
      <if test="shareDate != null" >
        #{shareDate},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.uton.carsokApi.model.ShareRecord" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update share_record
    <set >
      <if test="shareAccountCode != null" >
        share_account_code = #{shareAccountCode},
      </if>
      <if test="shareDate != null" >
        share_date = #{shareDate},
      </if>
    </set>
    where id = #{id}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.uton.carsokApi.model.ShareRecord" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update share_record
    set share_account_code = #{shareAccountCode},
      share_date = #{shareDate}
    where id = #{id}
  </update>

  <select id="shareRankList" parameterType="java.lang.String" resultMap="shareRankList">
    SELECT COUNT(1) count,ca.account_code,ca.account
    FROM carsok_acount ca
    WHERE ca.account_code = #{mobile}
    UNION ALL
    SELECT COUNT(1) ccacount,cca.child_account_mobile,cca.account_phone
    FROM carsok_child_account cca
    WHERE cca.child_account_mobile = #{mobile}
  </select>

  <select id="queryRankingCountByDay" resultType="java.util.HashMap">
    SELECT DATE_FORMAT(share_date, '%Y-%m-%d') days,
    <foreach collection="list" separator="," item="phone">
      count(IF(sr.share_account_code=#{phone},TRUE,NULL)) #{phone}
    </foreach>
    FROM share_record sr
    WHERE DATE_FORMAT(sr.share_date, '%Y-%m-%d') >= DATE_SUB(DATE_FORMAT(NOW(),'%Y%m%d'),INTERVAL 6 DAY)
    GROUP BY days
    ORDER BY 1 DESC
  </select>

  <select id="queryRankingCountByWeek" resultType="java.util.HashMap">
    SELECT DATE_FORMAT(sr.share_date, '%Y%u') weeks,
    <foreach collection="list" separator="," item="phone">
      count(IF(sr.share_account_code=#{phone},TRUE,NULL)) #{phone}
    </foreach>
    FROM share_record sr
    WHERE DATE_FORMAT(sr.share_date,'%Y-%m') = DATE_FORMAT(NOW(),'%Y-%m')
    GROUP BY weeks
    ORDER BY 1 DESC
  </select>

  <select id="queryRankingCountByMonth" resultType="java.util.HashMap">
    SELECT DATE_FORMAT(share_date, '%Y-%m') mon,
    <foreach collection="list" separator="," item="phone">
      count(IF(sr.share_account_code=#{phone},TRUE,NULL)) #{phone}
    </foreach>
    FROM share_record sr
    WHERE DATE_FORMAT(sr.share_date, '%Y') = DATE_FORMAT(NOW(),'%Y')
    GROUP BY mon
    ORDER BY 1 DESC
  </select>

  <resultMap id="contentPushList" type="com.uton.carsokApi.controller.response.ContentPushResponse">
    <result column="title" property="title" jdbcType="VARCHAR"/>
    <result column="content" property="content" jdbcType="VARCHAR"/>
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
  </resultMap>
  <select id="selectMessageList" resultMap="contentPushList">
    SELECT * FROM carsok_content_push where push_to IN(#{pushTo},'all') AND enable = 1 LIMIT #{p1},#{p2}
  </select>
  <select id="selectMessageCount" resultType="java.lang.Integer">
    SELECT count(*) from carsok_content_push where push_to IN(#{pushTo},'all') AND enable = 1 and content_type = 'systems'
  </select>

  <select id="getAcountPhone" resultType="java.lang.String">
    SELECT a.account
    FROM carsok_acount a
    LEFT JOIN carsok_product b
    ON b.account_id = a.id
    WHERE b.id = #{productId}
  </select>
</mapper>